[2021-09-05 13:08:34,158] {taskinstance.py:903} INFO - Dependencies all met for <TaskInstance: airflow-db-cleanup.cleanup_DagRun 2021-09-04T00:00:00+00:00 [queued]>
[2021-09-05 13:08:34,183] {taskinstance.py:903} INFO - Dependencies all met for <TaskInstance: airflow-db-cleanup.cleanup_DagRun 2021-09-04T00:00:00+00:00 [queued]>
[2021-09-05 13:08:34,183] {taskinstance.py:1094} INFO - 
--------------------------------------------------------------------------------
[2021-09-05 13:08:34,183] {taskinstance.py:1095} INFO - Starting attempt 1 of 2
[2021-09-05 13:08:34,183] {taskinstance.py:1096} INFO - 
--------------------------------------------------------------------------------
[2021-09-05 13:08:34,222] {taskinstance.py:1114} INFO - Executing <Task(PythonOperator): cleanup_DagRun> on 2021-09-04T00:00:00+00:00
[2021-09-05 13:08:34,226] {standard_task_runner.py:52} INFO - Started process 4013 to run task
[2021-09-05 13:08:34,234] {standard_task_runner.py:76} INFO - Running: ['airflow', 'tasks', 'run', 'airflow-db-cleanup', 'cleanup_DagRun', '2021-09-04T00:00:00+00:00', '--job-id', '223', '--pool', 'default_pool', '--raw', '--subdir', 'DAGS_FOLDER/airflow-db-cleanup.py', '--cfg-path', '/tmp/tmp0j3leib3', '--error-file', '/tmp/tmpcnnrtare']
[2021-09-05 13:08:34,235] {standard_task_runner.py:77} INFO - Job 223: Subtask cleanup_DagRun
[2021-09-05 13:08:34,355] {logging_mixin.py:109} INFO - Running <TaskInstance: airflow-db-cleanup.cleanup_DagRun 2021-09-04T00:00:00+00:00 [running]> on host 2bce3265bb98
[2021-09-05 13:08:34,489] {taskinstance.py:1251} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=operations
AIRFLOW_CTX_DAG_ID=airflow-db-cleanup
AIRFLOW_CTX_TASK_ID=cleanup_DagRun
AIRFLOW_CTX_EXECUTION_DATE=2021-09-04T00:00:00+00:00
AIRFLOW_CTX_DAG_RUN_ID=scheduled__2021-09-04T00:00:00+00:00
[2021-09-05 13:08:34,490] {airflow-db-cleanup.py:265} INFO - Retrieving max_execution_date from XCom
[2021-09-05 13:08:34,500] {airflow-db-cleanup.py:278} INFO - Configurations:
[2021-09-05 13:08:34,500] {airflow-db-cleanup.py:279} INFO - max_date:                 2021-09-04 13:08:33.176519+00:00
[2021-09-05 13:08:34,500] {airflow-db-cleanup.py:280} INFO - enable_delete:            True
[2021-09-05 13:08:34,500] {airflow-db-cleanup.py:281} INFO - session:                  <sqlalchemy.orm.session.Session object at 0x7f59f8bd2280>
[2021-09-05 13:08:34,500] {airflow-db-cleanup.py:282} INFO - airflow_db_model:         <class 'airflow.models.dagrun.DagRun'>
[2021-09-05 13:08:34,501] {airflow-db-cleanup.py:283} INFO - state:                    None
[2021-09-05 13:08:34,501] {airflow-db-cleanup.py:284} INFO - age_check_column:         DagRun.execution_date
[2021-09-05 13:08:34,501] {airflow-db-cleanup.py:285} INFO - keep_last:                True
[2021-09-05 13:08:34,501] {airflow-db-cleanup.py:286} INFO - keep_last_filters:        [<sqlalchemy.sql.elements.BinaryExpression object at 0x7f59f8bd21f0>]
[2021-09-05 13:08:34,501] {airflow-db-cleanup.py:287} INFO - keep_last_group_by:       DagRun.dag_id
[2021-09-05 13:08:34,501] {airflow-db-cleanup.py:289} INFO - 
[2021-09-05 13:08:34,501] {airflow-db-cleanup.py:291} INFO - Running Cleanup Process...
[2021-09-05 13:08:34,502] {airflow-db-cleanup.py:298} INFO - INITIAL QUERY : SELECT dag_run.id AS dag_run_id, dag_run.execution_date AS dag_run_execution_date 
FROM dag_run
[2021-09-05 13:08:34,503] {airflow-db-cleanup.py:309} INFO - SUB QUERY [keep_last_filters]: SELECT max(dag_run.execution_date) AS max_1 
FROM dag_run 
WHERE dag_run.external_trigger IS false
[2021-09-05 13:08:34,504] {airflow-db-cleanup.py:313} INFO - SUB QUERY [keep_last_group_by]: SELECT max(dag_run.execution_date) AS max_1 
FROM dag_run 
WHERE dag_run.external_trigger IS false GROUP BY dag_run.dag_id
[2021-09-05 13:08:34,517] {airflow-db-cleanup.py:329} INFO - Query: SELECT dag_run.id AS dag_run_id, dag_run.execution_date AS dag_run_execution_date 
FROM dag_run 
WHERE dag_run.execution_date NOT IN (SELECT anon_1.max_1 AS anon_1_max_1 
FROM (SELECT max(dag_run.execution_date) AS max_1 
FROM dag_run 
WHERE dag_run.external_trigger IS false GROUP BY dag_run.dag_id) AS anon_1) AND dag_run.execution_date <= %(execution_date_1)s
[2021-09-05 13:08:34,517] {airflow-db-cleanup.py:330} INFO - Process will be Deleting the following DagRun(s):
[2021-09-05 13:08:34,523] {airflow-db-cleanup.py:335} INFO - 	Entry: <DagRun hello_gdive @ 2021-09-03 08:47:05.140956+00:00: manual__2021-09-03T08:47:05.140956+00:00, externally triggered: True>, Date: 2021-09-03 08:47:05.140956+00:00
[2021-09-05 13:08:34,529] {airflow-db-cleanup.py:335} INFO - 	Entry: <DagRun hello_gdive @ 2021-09-03 08:48:47.840535+00:00: manual__2021-09-03T08:48:47.840535+00:00, externally triggered: True>, Date: 2021-09-03 08:48:47.840535+00:00
[2021-09-05 13:08:34,534] {airflow-db-cleanup.py:335} INFO - 	Entry: <DagRun hello_world @ 2021-08-31 17:00:00+00:00: scheduled__2021-08-31T17:00:00+00:00, externally triggered: False>, Date: 2021-08-31 17:00:00+00:00
[2021-09-05 13:08:34,543] {airflow-db-cleanup.py:335} INFO - 	Entry: <DagRun hello_world @ 2021-09-01 17:00:00+00:00: scheduled__2021-09-01T17:00:00+00:00, externally triggered: False>, Date: 2021-09-01 17:00:00+00:00
[2021-09-05 13:08:34,543] {airflow-db-cleanup.py:340} INFO - Process will be Deleting 4 DagRun(s)
[2021-09-05 13:08:34,543] {airflow-db-cleanup.py:349} INFO - Performing Delete...
[2021-09-05 13:08:34,553] {airflow-db-cleanup.py:353} INFO - Finished Performing Delete
[2021-09-05 13:08:34,553] {airflow-db-cleanup.py:358} INFO - Finished Running Cleanup Process
[2021-09-05 13:08:34,553] {python.py:151} INFO - Done. Returned value was: None
[2021-09-05 13:08:34,581] {taskinstance.py:1211} INFO - Marking task as SUCCESS. dag_id=airflow-db-cleanup, task_id=cleanup_DagRun, execution_date=20210904T000000, start_date=20210905T130834, end_date=20210905T130834
[2021-09-05 13:08:34,663] {local_task_job.py:151} INFO - Task exited with return code 0
[2021-09-05 13:08:34,707] {local_task_job.py:261} INFO - 0 downstream tasks scheduled from follow-on schedule check
