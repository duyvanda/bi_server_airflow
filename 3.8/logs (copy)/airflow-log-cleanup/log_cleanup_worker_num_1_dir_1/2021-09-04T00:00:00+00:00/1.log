[2021-09-05 13:16:30,734] {taskinstance.py:903} INFO - Dependencies all met for <TaskInstance: airflow-log-cleanup.log_cleanup_worker_num_1_dir_1 2021-09-04T00:00:00+00:00 [queued]>
[2021-09-05 13:16:30,745] {taskinstance.py:903} INFO - Dependencies all met for <TaskInstance: airflow-log-cleanup.log_cleanup_worker_num_1_dir_1 2021-09-04T00:00:00+00:00 [queued]>
[2021-09-05 13:16:30,746] {taskinstance.py:1094} INFO - 
--------------------------------------------------------------------------------
[2021-09-05 13:16:30,746] {taskinstance.py:1095} INFO - Starting attempt 1 of 2
[2021-09-05 13:16:30,746] {taskinstance.py:1096} INFO - 
--------------------------------------------------------------------------------
[2021-09-05 13:16:30,760] {taskinstance.py:1114} INFO - Executing <Task(BashOperator): log_cleanup_worker_num_1_dir_1> on 2021-09-04T00:00:00+00:00
[2021-09-05 13:16:30,765] {standard_task_runner.py:52} INFO - Started process 5025 to run task
[2021-09-05 13:16:30,768] {standard_task_runner.py:76} INFO - Running: ['airflow', 'tasks', 'run', 'airflow-log-cleanup', 'log_cleanup_worker_num_1_dir_1', '2021-09-04T00:00:00+00:00', '--job-id', '227', '--pool', 'default_pool', '--raw', '--subdir', 'DAGS_FOLDER/airflow-log-cleanup.py', '--cfg-path', '/tmp/tmpmutazo4_', '--error-file', '/tmp/tmpr23nqrqd']
[2021-09-05 13:16:30,769] {standard_task_runner.py:77} INFO - Job 227: Subtask log_cleanup_worker_num_1_dir_1
[2021-09-05 13:16:30,805] {logging_mixin.py:109} INFO - Running <TaskInstance: airflow-log-cleanup.log_cleanup_worker_num_1_dir_1 2021-09-04T00:00:00+00:00 [running]> on host 2bce3265bb98
[2021-09-05 13:16:30,850] {taskinstance.py:1251} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=operations
AIRFLOW_CTX_DAG_ID=airflow-log-cleanup
AIRFLOW_CTX_TASK_ID=log_cleanup_worker_num_1_dir_1
AIRFLOW_CTX_EXECUTION_DATE=2021-09-04T00:00:00+00:00
AIRFLOW_CTX_DAG_RUN_ID=scheduled__2021-09-04T00:00:00+00:00
[2021-09-05 13:16:30,851] {subprocess.py:52} INFO - Tmp dir root location: 
 /tmp
[2021-09-05 13:16:30,852] {subprocess.py:63} INFO - Running command: ['bash', '-c', '\n\necho "Getting Configurations..."\nBASE_LOG_FOLDER="/usr/local/airflow/logs/scheduler"\nWORKER_SLEEP_TIME="3"\n\nsleep ${WORKER_SLEEP_TIME}s\n\nMAX_LOG_AGE_IN_DAYS=""\nif [ "${MAX_LOG_AGE_IN_DAYS}" == "" ]; then\n    echo "maxLogAgeInDays conf variable isn\'t included. Using Default \'1\'."\n    MAX_LOG_AGE_IN_DAYS=\'1\'\nfi\nENABLE_DELETE=true\necho "Finished Getting Configurations"\necho ""\n\necho "Configurations:"\necho "BASE_LOG_FOLDER:      \'${BASE_LOG_FOLDER}\'"\necho "MAX_LOG_AGE_IN_DAYS:  \'${MAX_LOG_AGE_IN_DAYS}\'"\necho "ENABLE_DELETE:        \'${ENABLE_DELETE}\'"\n\ncleanup() {\n    echo "Executing Find Statement: $1"\n    FILES_MARKED_FOR_DELETE=`eval $1`\n    echo "Process will be Deleting the following File(s)/Directory(s):"\n    echo "${FILES_MARKED_FOR_DELETE}"\n    echo "Process will be Deleting `echo "${FILES_MARKED_FOR_DELETE}" |     grep -v \'^$\' | wc -l` File(s)/Directory(s)"         # "grep -v \'^$\'" - removes empty lines.\n    # "wc -l" - Counts the number of lines\n    echo ""\n    if [ "${ENABLE_DELETE}" == "true" ];\n    then\n        if [ "${FILES_MARKED_FOR_DELETE}" != "" ];\n        then\n            echo "Executing Delete Statement: $2"\n            eval $2\n            DELETE_STMT_EXIT_CODE=$?\n            if [ "${DELETE_STMT_EXIT_CODE}" != "0" ]; then\n                echo "Delete process failed with exit code                     \'${DELETE_STMT_EXIT_CODE}\'"\n\n                echo "Removing lock file..."\n                rm -f /tmp/airflow_log_cleanup_worker.lock\n                if [ "${REMOVE_LOCK_FILE_EXIT_CODE}" != "0" ]; then\n                    echo "Error removing the lock file.                     Check file permissions.                    To re-run the DAG, ensure that the lock file has been                     deleted (/tmp/airflow_log_cleanup_worker.lock)."\n                    exit ${REMOVE_LOCK_FILE_EXIT_CODE}\n                fi\n                exit ${DELETE_STMT_EXIT_CODE}\n            fi\n        else\n            echo "WARN: No File(s)/Directory(s) to Delete"\n        fi\n    else\n        echo "WARN: You\'re opted to skip deleting the File(s)/Directory(s)!!!"\n    fi\n}\n\n\nif [ ! -f /tmp/airflow_log_cleanup_worker.lock ]; then\n\n    echo "Lock file not found on this node!     Creating it to prevent collisions..."\n    touch /tmp/airflow_log_cleanup_worker.lock\n    CREATE_LOCK_FILE_EXIT_CODE=$?\n    if [ "${CREATE_LOCK_FILE_EXIT_CODE}" != "0" ]; then\n        echo "Error creating the lock file.         Check if the airflow user can create files under tmp directory.         Exiting..."\n        exit ${CREATE_LOCK_FILE_EXIT_CODE}\n    fi\n\n    echo ""\n    echo "Running Cleanup Process..."\n\n    FIND_STATEMENT="find ${BASE_LOG_FOLDER}/*/* -type f -mtime      +${MAX_LOG_AGE_IN_DAYS}"\n    DELETE_STMT="${FIND_STATEMENT} -exec rm -f {} \\;"\n\n    cleanup "${FIND_STATEMENT}" "${DELETE_STMT}"\n    CLEANUP_EXIT_CODE=$?\n\n    FIND_STATEMENT="find ${BASE_LOG_FOLDER}/*/* -type d -empty"\n    DELETE_STMT="${FIND_STATEMENT} -prune -exec rm -rf {} \\;"\n\n    cleanup "${FIND_STATEMENT}" "${DELETE_STMT}"\n    CLEANUP_EXIT_CODE=$?\n\n    FIND_STATEMENT="find ${BASE_LOG_FOLDER}/* -type d -empty"\n    DELETE_STMT="${FIND_STATEMENT} -prune -exec rm -rf {} \\;"\n\n    cleanup "${FIND_STATEMENT}" "${DELETE_STMT}"\n    CLEANUP_EXIT_CODE=$?\n\n    echo "Finished Running Cleanup Process"\n\n    echo "Deleting lock file..."\n    rm -f /tmp/airflow_log_cleanup_worker.lock\n    REMOVE_LOCK_FILE_EXIT_CODE=$?\n    if [ "${REMOVE_LOCK_FILE_EXIT_CODE}" != "0" ]; then\n        echo "Error removing the lock file. Check file permissions. To re-run the DAG, ensure that the lock file has been deleted (/tmp/airflow_log_cleanup_worker.lock)."\n        exit ${REMOVE_LOCK_FILE_EXIT_CODE}\n    fi\n\nelse\n    echo "Another task is already deleting logs on this worker node.     Skipping it!"\n    echo "If you believe you\'re receiving this message in error, kindly check     if /tmp/airflow_log_cleanup_worker.lock exists and delete it."\n    exit 0\nfi\n']
[2021-09-05 13:16:30,859] {subprocess.py:74} INFO - Output:
[2021-09-05 13:16:30,860] {subprocess.py:78} INFO - Getting Configurations...
[2021-09-05 13:16:33,861] {subprocess.py:78} INFO - maxLogAgeInDays conf variable isn't included. Using Default '1'.
[2021-09-05 13:16:33,861] {subprocess.py:78} INFO - Finished Getting Configurations
[2021-09-05 13:16:33,861] {subprocess.py:78} INFO - 
[2021-09-05 13:16:33,861] {subprocess.py:78} INFO - Configurations:
[2021-09-05 13:16:33,862] {subprocess.py:78} INFO - BASE_LOG_FOLDER:      '/usr/local/airflow/logs/scheduler'
[2021-09-05 13:16:33,862] {subprocess.py:78} INFO - MAX_LOG_AGE_IN_DAYS:  '1'
[2021-09-05 13:16:33,862] {subprocess.py:78} INFO - ENABLE_DELETE:        'true'
[2021-09-05 13:16:33,862] {subprocess.py:78} INFO - Lock file not found on this node!     Creating it to prevent collisions...
[2021-09-05 13:16:33,863] {subprocess.py:78} INFO - 
[2021-09-05 13:16:33,863] {subprocess.py:78} INFO - Running Cleanup Process...
[2021-09-05 13:16:33,863] {subprocess.py:78} INFO - Executing Find Statement: find /usr/local/airflow/logs/scheduler/*/* -type f -mtime      +1
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - Process will be Deleting the following File(s)/Directory(s):
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-02/helloworld.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-02/__pycache__/mssqlToCSV.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-02/writefile.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_xcomargs.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_python_operator.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_trigger_controller_dag.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_complex.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_skip_dag.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/tutorial.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_kubernetes_executor_config.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/subdags/subdag.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_latest_only_with_trigger.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_branch_labels.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_task_group_decorator.py.log
[2021-09-05 13:16:33,868] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_branch_operator.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/tutorial_taskflow_api_etl.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_trigger_target_dag.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_kubernetes_executor.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_dag_decorator.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_bash_operator.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_branch_datetime_operator.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/tutorial_etl_dag.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_external_task_marker_dag.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_task_group.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_branch_python_dop_operator_3.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_passing_params_via_test_command.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_subdag_operator.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/tutorial_taskflow_api_etl_virtualenv.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_branch_day_of_week_operator.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_nested_branch_dag.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_xcom.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/test_utils.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_latest_only.py.log
[2021-09-05 13:16:33,869] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/example_short_circuit_operator.py.log
[2021-09-05 13:16:33,870] {subprocess.py:78} INFO - Process will be Deleting 34 File(s)/Directory(s)
[2021-09-05 13:16:33,870] {subprocess.py:78} INFO - 
[2021-09-05 13:16:33,870] {subprocess.py:78} INFO - Executing Delete Statement: find /usr/local/airflow/logs/scheduler/*/* -type f -mtime      +1 -exec rm -f {} \;
[2021-09-05 13:16:33,896] {subprocess.py:78} INFO - Executing Find Statement: find /usr/local/airflow/logs/scheduler/*/* -type d -empty
[2021-09-05 13:16:33,899] {subprocess.py:78} INFO - Process will be Deleting the following File(s)/Directory(s):
[2021-09-05 13:16:33,899] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-02/__pycache__
[2021-09-05 13:16:33,899] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags/subdags
[2021-09-05 13:16:33,902] {subprocess.py:78} INFO - Process will be Deleting 2 File(s)/Directory(s)
[2021-09-05 13:16:33,902] {subprocess.py:78} INFO - 
[2021-09-05 13:16:33,902] {subprocess.py:78} INFO - Executing Delete Statement: find /usr/local/airflow/logs/scheduler/*/* -type d -empty -prune -exec rm -rf {} \;
[2021-09-05 13:16:33,905] {subprocess.py:78} INFO - Executing Find Statement: find /usr/local/airflow/logs/scheduler/* -type d -empty
[2021-09-05 13:16:33,907] {subprocess.py:78} INFO - Process will be Deleting the following File(s)/Directory(s):
[2021-09-05 13:16:33,907] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-02
[2021-09-05 13:16:33,907] {subprocess.py:78} INFO - /usr/local/airflow/logs/scheduler/2021-09-03/native_dags/example_dags
[2021-09-05 13:16:33,909] {subprocess.py:78} INFO - Process will be Deleting 2 File(s)/Directory(s)
[2021-09-05 13:16:33,909] {subprocess.py:78} INFO - 
[2021-09-05 13:16:33,909] {subprocess.py:78} INFO - Executing Delete Statement: find /usr/local/airflow/logs/scheduler/* -type d -empty -prune -exec rm -rf {} \;
[2021-09-05 13:16:33,912] {subprocess.py:78} INFO - Finished Running Cleanup Process
[2021-09-05 13:16:33,913] {subprocess.py:78} INFO - Deleting lock file...
[2021-09-05 13:16:33,914] {subprocess.py:82} INFO - Command exited with return code 0
[2021-09-05 13:16:33,935] {taskinstance.py:1211} INFO - Marking task as SUCCESS. dag_id=airflow-log-cleanup, task_id=log_cleanup_worker_num_1_dir_1, execution_date=20210904T000000, start_date=20210905T131630, end_date=20210905T131633
[2021-09-05 13:16:33,954] {local_task_job.py:151} INFO - Task exited with return code 0
[2021-09-05 13:16:33,974] {local_task_job.py:261} INFO - 0 downstream tasks scheduled from follow-on schedule check
